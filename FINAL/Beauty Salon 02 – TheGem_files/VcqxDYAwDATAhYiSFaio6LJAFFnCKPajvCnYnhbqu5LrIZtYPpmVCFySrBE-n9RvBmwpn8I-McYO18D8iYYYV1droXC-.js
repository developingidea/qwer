/*
 * Masonry layout mode
 * sub-classes Masonry
 * http://masonry.desandro.com
 */
(function(window,factory){'use strict';if(typeof define=='function'&&define.amd){define(['../layout-mode','masonry/masonry'],factory);}else if(typeof exports=='object'){module.exports=factory(require('../layout-mode'),require('masonry-layout'));}else{factory(window.Isotope.LayoutMode,window.Masonry);}}(window,function factory(LayoutMode,Masonry){'use strict';function extend(a,b){for(var prop in b){a[prop]=b[prop];}
return a;}
var MasonryMode=LayoutMode.create('masonry-custom');var _getElementOffset=MasonryMode.prototype._getElementOffset;var layout=MasonryMode.prototype.layout;var _getMeasurement=MasonryMode.prototype._getMeasurement;extend(MasonryMode.prototype,Masonry.prototype);MasonryMode.prototype._getElementOffset=_getElementOffset;MasonryMode.prototype.layout=layout;MasonryMode.prototype._getMeasurement=_getMeasurement;var measureColumns=MasonryMode.prototype.measureColumns;MasonryMode.prototype.measureColumns=function(){this.items=this.isotope.filteredItems;measureColumns.call(this);};var _manageStamp=MasonryMode.prototype._manageStamp;MasonryMode.prototype._manageStamp=function(){this.options.isOriginLeft=this.isotope.options.isOriginLeft;this.options.isOriginTop=this.isotope.options.isOriginTop;_manageStamp.apply(this,arguments);};function getStyle(elem){return window.getComputedStyle?getComputedStyle(elem,""):elem.currentStyle;}
MasonryMode.prototype.fix_images_height=function(){var self=this;var $=jQuery;var container=this.options.isFitWidth?this.element.parentNode:this.element;var $set=$(container);var max_heigth=0;var padding=parseInt($(self.isotope.options.itemSelector,$set).not('.double-item').first().css('padding-top'));var caption=0;if(self.isotope.options.itemSelector=='.portfolio-item'){if($(self.isotope.options.itemSelector,$set).not('.double-item').first().find('.wrap > .caption').is(':visible')){caption=parseInt($(self.isotope.options.itemSelector,$set).not('.double-item').first().find('.wrap > .caption').outerHeight());}}
var fix_caption=false;$(self.isotope.options.itemSelector,$set).not('.double-item').each(function(){var height=parseFloat(getStyle($(self.isotope.options.itemImageWrapperSelector,this)[0]).height);var diff=height-parseInt(height);if(diff<0.5){height=parseInt(height);}
if((height-parseInt(height))>0.5){height=parseInt(height+0.5);fix_caption=true;}
if(height>max_heigth){max_heigth=height;}});if(caption>0&&fix_caption){caption-=1;}
$(self.isotope.options.itemSelector+'.double-item-horizontal '+self.isotope.options.itemImageWrapperSelector+', '+self.isotope.options.itemSelector+'.double-item-vertical '+self.isotope.options.itemImageWrapperSelector,$set).css('height','');$(self.isotope.options.itemSelector+'.double-item-horizontal',$set).each(function(){var height=$(self.isotope.options.itemImageWrapperSelector,this).height();if(height>max_heigth){$(self.isotope.options.itemImageWrapperSelector,this).height(max_heigth);}});$(self.isotope.options.itemSelector+'.double-item-vertical',$set).each(function(){var height=$(self.isotope.options.itemImageWrapperSelector,this).height();var calc_height=2*(max_heigth+padding)+caption;if(height>calc_height){$(self.isotope.options.itemImageWrapperSelector,this).height(calc_height);}});}
var _resetLayout=MasonryMode.prototype._resetLayout;MasonryMode.prototype._resetLayout=function(){if(this.isotope.options.fixHeightDoubleItems){this.fix_images_height();}
_resetLayout.apply(this,arguments);};return MasonryMode;}));;(function(factory){if(typeof define!=='undefined'&&define.amd){define([],factory);}else if(typeof module!=='undefined'&&module.exports){module.exports=factory();}else{window.scrollMonitor=factory();}})(function(){var scrollTop=function(){return window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;};var exports={};var watchers=[];var VISIBILITYCHANGE='visibilityChange';var ENTERVIEWPORT='enterViewport';var FULLYENTERVIEWPORT='fullyEnterViewport';var EXITVIEWPORT='exitViewport';var PARTIALLYEXITVIEWPORT='partiallyExitViewport';var LOCATIONCHANGE='locationChange';var STATECHANGE='stateChange';var eventTypes=[VISIBILITYCHANGE,ENTERVIEWPORT,FULLYENTERVIEWPORT,EXITVIEWPORT,PARTIALLYEXITVIEWPORT,LOCATIONCHANGE,STATECHANGE];var defaultOffsets={top:0,bottom:0};var getViewportHeight=function(){return window.innerHeight||document.documentElement.clientHeight;};var getDocumentHeight=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight);};exports.viewportTop=null;exports.viewportBottom=null;exports.documentHeight=null;exports.viewportHeight=getViewportHeight();var previousDocumentHeight;var latestEvent;var calculateViewportI;function calculateViewport(){exports.viewportTop=scrollTop();exports.viewportBottom=exports.viewportTop+exports.viewportHeight;exports.documentHeight=getDocumentHeight();if(exports.documentHeight!==previousDocumentHeight){calculateViewportI=watchers.length;while(calculateViewportI--){watchers[calculateViewportI].recalculateLocation();}
previousDocumentHeight=exports.documentHeight;}}
function recalculateWatchLocationsAndTrigger(){exports.viewportHeight=getViewportHeight();calculateViewport();updateAndTriggerWatchers();}
var recalculateAndTriggerTimer;function debouncedRecalcuateAndTrigger(){clearTimeout(recalculateAndTriggerTimer);recalculateAndTriggerTimer=setTimeout(recalculateWatchLocationsAndTrigger,100);}
var updateAndTriggerWatchersI;function updateAndTriggerWatchers(){updateAndTriggerWatchersI=watchers.length;var i=0;while(i<updateAndTriggerWatchersI){watchers[i].update();i++;}
updateAndTriggerWatchersI=watchers.length;var j=0,newLength;while(j<updateAndTriggerWatchersI){watchers[j].triggerCallbacks();newLength=watchers.length;if(newLength<updateAndTriggerWatchersI){j-=updateAndTriggerWatchersI-newLength;}
updateAndTriggerWatchersI=newLength;j++;}}
function ElementWatcher(watchItem,offsets){var self=this;this.watchItem=watchItem;this.uid=Math.random().toString(36).substring(8);if(!offsets){this.offsets=defaultOffsets;}else if(offsets===+offsets){this.offsets={top:offsets,bottom:offsets};}else{this.offsets={top:offsets.top||defaultOffsets.top,bottom:offsets.bottom||defaultOffsets.bottom};}
this.callbacks={};for(var i=0,j=eventTypes.length;i<j;i++){self.callbacks[eventTypes[i]]=[];}
this.locked=false;var wasInViewport;var wasFullyInViewport;var wasAboveViewport;var wasBelowViewport;var listenerToTriggerListI;var listener;function triggerCallbackArray(listeners){if(listeners.length===0){return;}
listenerToTriggerListI=listeners.length;while(listenerToTriggerListI--){listener=listeners[listenerToTriggerListI];listener.callback.call(self,latestEvent);if(listener.isOne){listeners.splice(listenerToTriggerListI,1);}}}
this.triggerCallbacks=function triggerCallbacks(){if(this.isInViewport&&!wasInViewport){triggerCallbackArray(this.callbacks[ENTERVIEWPORT]);}
if(this.isFullyInViewport&&!wasFullyInViewport){triggerCallbackArray(this.callbacks[FULLYENTERVIEWPORT]);}
if(this.isAboveViewport!==wasAboveViewport&&this.isBelowViewport!==wasBelowViewport){triggerCallbackArray(this.callbacks[VISIBILITYCHANGE]);if(!wasFullyInViewport&&!this.isFullyInViewport){triggerCallbackArray(this.callbacks[FULLYENTERVIEWPORT]);triggerCallbackArray(this.callbacks[PARTIALLYEXITVIEWPORT]);}
if(!wasInViewport&&!this.isInViewport){triggerCallbackArray(this.callbacks[ENTERVIEWPORT]);triggerCallbackArray(this.callbacks[EXITVIEWPORT]);}}
if(!this.isFullyInViewport&&wasFullyInViewport){triggerCallbackArray(this.callbacks[PARTIALLYEXITVIEWPORT]);}
if(!this.isInViewport&&wasInViewport){triggerCallbackArray(this.callbacks[EXITVIEWPORT]);}
if(this.isInViewport!==wasInViewport){triggerCallbackArray(this.callbacks[VISIBILITYCHANGE]);}
switch(true){case wasInViewport!==this.isInViewport:case wasFullyInViewport!==this.isFullyInViewport:case wasAboveViewport!==this.isAboveViewport:case wasBelowViewport!==this.isBelowViewport:triggerCallbackArray(this.callbacks[STATECHANGE]);}
wasInViewport=this.isInViewport;wasFullyInViewport=this.isFullyInViewport;wasAboveViewport=this.isAboveViewport;wasBelowViewport=this.isBelowViewport;};this.recalculateLocation=function(){if(this.locked){return;}
var previousTop=this.top;var previousBottom=this.bottom;if(this.watchItem.nodeName){var cachedDisplay=this.watchItem.style.display;if(cachedDisplay==='none'){this.watchItem.style.display='';}
var boundingRect=this.watchItem.getBoundingClientRect();this.top=boundingRect.top+exports.viewportTop;this.bottom=boundingRect.bottom+exports.viewportTop;if(cachedDisplay==='none'){this.watchItem.style.display=cachedDisplay;}}else if(this.watchItem===+this.watchItem){if(this.watchItem>0){this.top=this.bottom=this.watchItem;}else{this.top=this.bottom=exports.documentHeight-this.watchItem;}}else{this.top=this.watchItem.top;this.bottom=this.watchItem.bottom;}
this.top-=this.offsets.top;this.bottom+=this.offsets.bottom;this.height=this.bottom-this.top;if((previousTop!==undefined||previousBottom!==undefined)&&(this.top!==previousTop||this.bottom!==previousBottom)){triggerCallbackArray(this.callbacks[LOCATIONCHANGE]);}};this.recalculateLocation();this.update();wasInViewport=this.isInViewport;wasFullyInViewport=this.isFullyInViewport;wasAboveViewport=this.isAboveViewport;wasBelowViewport=this.isBelowViewport;}
ElementWatcher.prototype={on:function(event,callback,isOne){switch(true){case event===VISIBILITYCHANGE&&!this.isInViewport&&this.isAboveViewport:case event===ENTERVIEWPORT&&this.isInViewport:case event===FULLYENTERVIEWPORT&&this.isFullyInViewport:case event===EXITVIEWPORT&&this.isAboveViewport&&!this.isInViewport:case event===PARTIALLYEXITVIEWPORT&&this.isAboveViewport:callback.call(this,latestEvent);if(isOne){return;}}
if(this.callbacks[event]){this.callbacks[event].push({callback:callback,isOne:isOne||false});}else{throw new Error('Tried to add a scroll monitor listener of type '+event+'. Your options are: '+eventTypes.join(', '));}},off:function(event,callback){if(this.callbacks[event]){for(var i=0,item;item=this.callbacks[event][i];i++){if(item.callback===callback){this.callbacks[event].splice(i,1);break;}}}else{throw new Error('Tried to remove a scroll monitor listener of type '+event+'. Your options are: '+eventTypes.join(', '));}},one:function(event,callback){this.on(event,callback,true);},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom;this.bottom=this.top+this.height;},update:function(){this.isAboveViewport=this.top<exports.viewportTop;this.isBelowViewport=this.bottom>exports.viewportBottom;this.isInViewport=(this.top<=exports.viewportBottom&&this.bottom>=exports.viewportTop);this.isFullyInViewport=(this.top>=exports.viewportTop&&this.bottom<=exports.viewportBottom)||(this.isAboveViewport&&this.isBelowViewport);},destroy:function(){var index=-1;self=this;for(var i=0;i<watchers.length;i++){if(this.uid==watchers[i].uid){index=i;break;}}
if(index==-1){index=watchers.indexOf(this);}
watchers.splice(index,1);for(var i=0,j=eventTypes.length;i<j;i++){self.callbacks[eventTypes[i]].length=0;}},lock:function(){this.locked=true;},unlock:function(){this.locked=false;}};var eventHandlerFactory=function(type){return function(callback,isOne){this.on.call(this,type,callback,isOne);};};for(var i=0,j=eventTypes.length;i<j;i++){var type=eventTypes[i];ElementWatcher.prototype[type]=eventHandlerFactory(type);}
try{calculateViewport();}catch(e){try{window.$(calculateViewport);}catch(e){throw new Error('If you must put scrollMonitor in the <head>, you must use jQuery.');}}
function scrollMonitorListener(event){latestEvent=event;calculateViewport();updateAndTriggerWatchers();}
if(window.addEventListener){window.addEventListener('scroll',scrollMonitorListener);window.addEventListener('resize',debouncedRecalcuateAndTrigger);}else{window.attachEvent('onscroll',scrollMonitorListener);window.attachEvent('onresize',debouncedRecalcuateAndTrigger);}
exports.beget=exports.create=function(element,offsets){if(typeof element==='string'){element=document.querySelector(element);}else if(element&&element.length>0){element=element[0];}
var watcher=new ElementWatcher(element,offsets);watchers.push(watcher);watcher.update();return watcher;};exports.update=function(){latestEvent=null;calculateViewport();updateAndTriggerWatchers();};exports.recalculateLocations=function(){exports.documentHeight=0;exports.update();};return exports;});;(function($){var animations={'move-up':{timeout:200},bounce:{timeout:0},'fade-in':{timeout:100},scale:{timeout:100},flip:{timeout:100},'fall-perspective':{timeout:100},};var prefixes='Webkit Moz ms Ms O'.split(' ');var docElemStyle=document.documentElement.style;function getStyleProperty(propName){if(!propName){return;}
if(typeof docElemStyle[propName]==='string'){return propName;}
propName=propName.charAt(0).toUpperCase()+propName.slice(1);var prefixed;for(var i=0,len=prefixes.length;i<len;i++){prefixed=prefixes[i]+propName;if(typeof docElemStyle[prefixed]==='string'){return prefixed;}}}
var transitionProperty=getStyleProperty('transition');var transitionEndEvent={WebkitTransition:'webkitTransitionEnd',MozTransition:'transitionend',OTransition:'otransitionend',transition:'transitionend'}[transitionProperty];function ItemsAnimations(el,options){var self=this;this.el=el;this.$el=$(el);this.options={itemSelector:'',scrollMonitor:false,firstItemStatic:false};$.extend(this.options,options);this.$el.data('itemsAnimations',this);self.initialize();}
$.fn.itemsAnimations=function(options){if(typeof options==='string'){var instance=$(this.get(0)).data('itemsAnimations');if(!instance){return false;}
if(options==='instance'){return instance;}}else{return new ItemsAnimations(this.get(0),options);}}
ItemsAnimations.prototype={initialize:function(){var self=this;this.queue=[];this.queue_is_run=false;this.watchers={};this.animation=this.getAnimation();if(!this.animation||$(window).width()<767){this.animationName='disabled';this.animation=this.getAnimationByName('disabled');}
if(this.options.firstItemStatic){this.firstStatisItem=$(this.options.itemSelector+':first',this.$el);this.firstStatisItem.removeClass('item-animations-not-inited');}
if(this.animationName=='disabled'){$(this.options.itemSelector,this.$el).removeClass('item-animations-not-inited');}},show:function($items){var self=this;if(this.animationName=='disabled'){$(this.options.itemSelector,this.$el).removeClass('item-animations-not-inited');return false;}
if($items==undefined){$items=$(this.options.itemSelector,this.$el);}
$items.not('.item-animations-inited').each(function(index){var $this=$(this);$this.addClass('item-animations-inited');if(self.options.firstItemStatic&&self.firstStatisItem&&self.firstStatisItem.get(0)==this){return;}
if(self.options.scrollMonitor&&this.animationName!='disabled'){var watcher=scrollMonitor.create(this,-50);watcher.enterViewport(function(){var watcher=this;self.showItem($this,watcher);});self.watchers[watcher.uid]=watcher;}else{self.showItem($this);}});$(this.options.itemSelector,this.$el).not('.item-animations-inited').removeClass('item-animations-not-inited');if(self.options.scrollMonitor){}},reinitItems:function($items){$items.removeClass('start-animation item-animations-inited item-animations-loading before-start').addClass('item-animations-not-inited');this.clear();},getAnimationName:function(){var m=this.$el[0].className.match(/item-animation-(\S+)/);if(!m){return'';}
return m[1];},getAnimation:function(){this.animationName=this.getAnimationName();return this.getAnimationByName(this.animationName);},getAnimationByName:function(name){if(!name||animations[name]==undefined){return false;}
return animations[name];},showItem:function($item,watcher){var self=this;if($item.hasClass('item-animations-loading')){return false;}
function showItemCallback(){if($item.length==0){return false;}
self.animate($item);if(watcher!=undefined){self.destroyWatcher(watcher);}}
$item.addClass('item-animations-loading before-start');if(this.animation.timeout>0){this.queueAdd(showItemCallback,this.animation.timeout);}else{showItemCallback();}},destroyWatcher:function(watcher){if(this.watchers[watcher.uid]!=undefined){delete this.watchers[watcher.uid];}
watcher.destroy();},animate:function($item,animation){function transEnd(){}
setTimeout(function(){$item.removeClass('item-animations-loading item-animations-not-inited before-start').addClass('start-animation');},0);},queueAdd:function(callback,timeout){this.queue.push({callback:callback,timeout:timeout});if(this.queue.length==1&&!this.queue_is_run){this.queueNext();}},queueNext:function(){var self=this;if(this.queue.length==0){return false;}
var next_action=this.queue.shift();if(next_action==undefined){return false;}
this.queue_is_run=true;next_action.callback();setTimeout(function(){self.queue_is_run=false;self.queueNext();},next_action.timeout);},clear:function(){this.queue=[];this.queue_is_run=false;for(var watcher_uid in this.watchers){if(this.watchers.hasOwnProperty(watcher_uid)){this.destroyWatcher(this.watchers[watcher_uid]);}}
this.watchers=[];}};})(jQuery);